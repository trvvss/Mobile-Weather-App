<!doctype html>
<html>

  <head>
      <title>GOOD WEATHER</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css"/>
      <link rel="stylesheet" href="css/themes/ThemeRoller.css"/>
      <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
      <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
      <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
      <link rel="stylesheet" href="css/stylesheet.css"/>

      <script type="text/javascript">

      var icons = { "clear-day"           :   "B",
                    "clear-night"         :   "C",
                    "rain"                :   "R",
                    "snow"                :   "G",
                    "sleet"               :   "X",
                    "wind"                :   "S",
                    "fog"                 :   "N",
                    "cloudy"              :   "Y",
                    "partly-cloudy-day"   :   "H",
                    "parly-cloudy-night"  :   "I",
                  };

      var cities = {
                    "seattle"           : { coords  : {latitude: 47.606209, longitude:-122.332071}},
                    "los angeles"       : { coords  : {latitude: 34.052234, longitude:-118.243685}},
                    "new york city"     : { coords  : {latitude: 40.712784, longitude:-74.005941}},
                    "barcelona"         : { coords  : {latitude: 41.385064, longitude:2.173403}},
                    "seoul"             : { coords  : {latitude: 37.566535, longitude:126.977969}},
                    "current location"  : ""
                    };

      function loadWeather(cityCoords){

        var latlng = cityCoords.coords.latitude + "," + cityCoords.coords.longitude;

        var forecastURL = "https://api.forecast.io/forecast/f70e8c79b99541a9b246f5946778435b/"+latlng;

        $.ajax({
          url: forecastURL,
          jsonpCallback: 'jsonpCallback',
          contentType: "application/json",
          dataType: 'jsonp',
          success: function(json) {
            console.log(json);
            $("#current_temp").html(Math.round(json.currently.temperature)+"&#176F");
            $("#current_summary").html(json.currently.summary);
            $("#current_temp").attr("data-icon",icons[json.currently.icon]);
          },
          error: function(e){
            console.log(e.message);
          }
        });

      }

      function loadCity(city){
        $("#location").html(city);

        if(city.toLowerCase() == "current location"){
          if (navigator.geolocation){
            navigator.geolocation.getCurrentPosition(loadWeather,loadDefaultCity);
            console.log("geo success");
          } else{
            loadDefaultCity();
            console.log("geo fail");
          }
        } else {
          loadWeather(cities[city.toLowerCase()]);
        }
      }

      function loadDefaultCity(){
        loadCity("Seattle");
      }

      $(document).ready(function(){
        loadCity("Seattle");

        $("a.city").bind("click",function(){
          loadCity($(this).html());
        })
      });

      </script>

</head>

  <body>
    <div data-role="page">
      <div data-role="panel" id="left-panel" data-theme="a">
          <!-- panel content goes here -->
          <ul data-theme="a" data-role="listview">
            <li data-icon="delete"><a href="#" data-rel="close">Close</a></li>
            <li data-role="list-divider">Select a City</li>
              <li><a href="#" class="city" data-rel="close">Current Location</a></li>
              <li><a href="#" class="city" data-rel="close">Seattle</a></li>
              <li><a href="#" class="city" data-rel="close">Los Angeles</a></li>
              <li><a href="#" class="city" data-rel="close">New York City</a></li>
              <li><a href="#" class="city" data-rel="close">Barcelona</a></li>
              <li><a href="#" class="city" data-rel="close">Seoul</a></li>
            </ul>
      </div><!-- /panel -->
    	<div data-role="header" data-theme="a" data-position="fixed">
        <h1>WEATHER WATCH</h1>
        <a href="#left-panel" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-notext ui-icon-bars">Menu</a>
      </div>
    	<div role="main" class="ui-content">
        <h1 id="current_temp" class="icon" data-icon=""></h1>
        <p id="current_summary">Partly Cloudy</p>
        <p id="location">Current Location</p>
      </div>
    </div>
  </body>
</html>
